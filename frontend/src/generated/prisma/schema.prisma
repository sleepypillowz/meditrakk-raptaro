generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String   @id
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name  String
  email String @unique
  role  String

  patient Patient?
  doctor  Doctor?
}

model Patient {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  archived  Boolean  @default(false)

  userId String? @unique
  user   User?   @relation(fields: [userId], references: [id])

  name        String
  gender      String?
  dateOfBirth DateTime? @db.Date
  city        String?
  barangay    String?

  patientVisit   PatientVisit[]
  assessment     Assessment[]
  treatment      Treatment[]
  medicalRecords MedicalRecord[]
  appointment    Appointment[]
  prescription   Prescription[]
}

model PatientVisit {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patientId String
  patient   Patient @relation(fields: [patientId], references: [id])

  reason String
  status String
  date   DateTime @default(now())

  treatment Treatment[]
}

model Assessment {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patientId String
  patient   Patient @relation(fields: [patientId], references: [id])

  symptoms         String
  assessment       String?
  diagnosis        String?
  bloodPressure    String
  pulseRate        Int
  respiratoryRate  Int
  oxygenSaturation Float?
  alcoholUse       Boolean
  smoker           Boolean?
  allergies        String?
  painLocation     String?
  painScale        Int?

  treatment Treatment[]
}

model Treatment {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patientId    String
  patient      Patient       @relation(fields: [patientId], references: [id])
  visitId      String?
  visit        PatientVisit? @relation(fields: [visitId], references: [id])
  assessmentId String?
  assessment   Assessment?   @relation(fields: [assessmentId], references: [id])

  medications    Json?
  procedures     String?
  painScale      Int?
  remarks        String?
  status         TreatmentStatus @default(PENDING)
  priority       Int?
  followUps      FollowUp[]
  nextFollowUpAt DateTime?
}

model FollowUp {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  treatmentId  String
  treatment    Treatment @relation(fields: [treatmentId], references: [id])
  note         String?
  findings     String?
  outcome      String?
  nextAction   String?
  painScale    Int?
  vitals       Json?
  followUpDate DateTime  @default(now())
  nextFollowUp DateTime?
  resolved     Boolean   @default(false)
}

model MedicalRecord {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patientId String
  patient   Patient @relation(fields: [patientId], references: [id])

  diagnosis String
  treatment String
  notes     String?
}

model Doctor {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  archived  Boolean  @default(false)

  userId String? @unique
  user   User?   @relation(fields: [userId], references: [id])

  name  String
  field String

  appointment  Appointment[]
  prescription Prescription[]
}

model Appointment {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  archived  Boolean  @default(false)

  patientId String
  patient   Patient @relation(fields: [patientId], references: [id])
  doctorId  String
  doctor    Doctor  @relation(fields: [doctorId], references: [id])

  date   DateTime
  status String
}

model MedicineType {
  id       String @id @default(cuid())
  name     String @unique
  form     String
  strength String

  medicineBatch MedicineBatch[]
  prescription  Prescription[]
}

model MedicineBatch {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  medicineId String
  medicine   MedicineType @relation(fields: [medicineId], references: [id])

  batchNumber String
  quantity    Int
  expiryDate  DateTime
}

model Prescription {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patientId  String
  patient    Patient      @relation(fields: [patientId], references: [id])
  doctorId   String
  doctor     Doctor       @relation(fields: [doctorId], references: [id])
  medicineId String
  medicine   MedicineType @relation(fields: [medicineId], references: [id])

  quantity  Int
  frequency String
  duration  String
}

model Post {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  title     String
  slug      String   @unique
  content   String
  published Boolean? @default(false)
}

enum TreatmentStatus {
  PENDING
  ONGOING
  COMPLETED
  CANCELLED
}
